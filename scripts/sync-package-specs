#!/bin/bash
set -e -x

ROOT_DIR_PATH=$(cd $(dirname $0)/.. && pwd)

pushd $ROOT_DIR_PATH/packages/guardian
  {
    cat spec | grep -v '# gosub'
    $ROOT_DIR_PATH/scripts/guardian-deps | \
      sed -e 's/\(.*\)/  - \1\/*.go # gosub/g'
  } > spec.new

  mv spec.new spec
popd

export GOOS=linux
pushd $ROOT_DIR_PATH/packages/gdn
  {
    cat spec | grep -v '# gosub'
    $ROOT_DIR_PATH/scripts/gdn-deps | grep -v "code.cloudfoundry.org/gdn/bindata" | \
      sed -e 's/\(.*\)/  - \1\/*.go # gosub/g'
  } > spec.new

  mv spec.new spec
popd
